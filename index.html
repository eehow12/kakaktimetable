<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadwal Pengasuh Mingguan</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #e9eef3;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    .banner {
      color: white;
      padding: 15px;
      border-radius: 12px;
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.5s ease;
    }

    .weekA { background: linear-gradient(90deg, #007bff, #00bfff); }
    .weekB { background: linear-gradient(90deg, #28a745, #70db70); }

    #dateRange {
      font-size: 1em;
      margin-bottom: 20px;
      color: #333;
      border: 1px solid #ccc;
      background: rgba(200, 220, 235, 0.5);
      border-radius: 10px;
      display: inline-block;
      padding: 5px 12px;
      transition: background 0.3s ease;
    }

    table {
      width: 100%;
      max-width: 850px;
      margin: 0 auto;
      border-collapse: collapse;
      background-color: #f8fbff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
      vertical-align: middle;
      position: relative;
      overflow: hidden;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    tr:hover {
      background-color: #f9f9f9;
    }

    /* Alternating background emojis */
    td:nth-child(2)::after { content: "üç≥"; }
    td:nth-child(3)::after { content: "‚òï"; }
    td:nth-child(4)::after { content: "üßΩ"; }
    td:nth-child(5)::after { content: "üçΩÔ∏è"; }
    td:nth-child(6)::after { content: "ü™•"; }
    td:nth-child(7)::after { content: "üõèÔ∏è"; }

    td::after {
      opacity: 0.12;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      pointer-events: none;
    }

    .today {
      background-color: #fff0f5 !important;
      font-weight: bold;
      position: relative;
    }

    .today::before {
      content: "üçì ";
      position: absolute;
      left: 8px;
      top: 8px;
    }

    button {
      margin: 10px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      color: white;
      transition: background 0.3s ease;
    }

    #switchWeek {
      background: linear-gradient(90deg, #007bff, #00bfff);
    }

    #switchWeek:hover {
      filter: brightness(0.9);
    }

    #exportCSV {
      background: #6c757d;
    }

    input[type="date"], input[type="password"] {
      margin: 10px;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    @media (max-width: 600px) {
      table, th, td {
        font-size: 0.8em;
        padding: 8px;
      }
      .banner {
        font-size: 1.1em;
      }
      button {
        width: 90%;
        margin: 5px auto;
      }
    }
  </style>
</head>
<body>

  <div id="banner" class="banner"></div>
  <div id="dateRange"></div>

  <div>
    <label for="fname">Kata Sandi:</label>
    <input type="password" id="fname" name="fname" autocomplete="new-password">
    <button id="switchWeek">Ganti Minggu (A ‚Üî B)</button>
    <button id="exportCSV">Ekspor CSV</button>
    <br>
    <label for="refDate">Ubah Minggu Acuan (Hari Minggu):</label>
    <input type="date" id="refDate">
  </div>

  <table id="scheduleTable"></table>

  <script>
    const weekA = { name: "Minggu A", onCall: "Kusni", morning: "Ririn" };
    const weekB = { name: "Minggu B", onCall: "Ririn", morning: "Kusni" };
    const days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

    // Week A starts Sunday 19 Oct 2025
    let referenceSunday = new Date(Date.UTC(2025, 9, 19)); // UTC Sunday 19 Oct 2025

    const malaysiaOffsetMs = 8 * 60 * 60 * 1000; // GMT+8

    function getMalaysiaNow() {
      return new Date(Date.now() + malaysiaOffsetMs);
    }

    function getWeekType(ref) {
      const now = getMalaysiaNow();
      const diffWeeks = Math.floor((now - ref) / (1000 * 60 * 60 * 24 * 7));
      return diffWeeks % 2 === 0 ? "A" : "B";
    }

    function getWeekRange(ref) {
      const now = getMalaysiaNow();
      const diffWeeks = Math.floor((now - ref) / (1000 * 60 * 60 * 24 * 7));
      const start = new Date(ref.getTime() + diffWeeks * 7 * 86400000);
      const end = new Date(start.getTime() + 6 * 86400000);
      return { start, end };
    }

    function formatDate(date) {
      return date.toLocaleDateString("id-ID", { day: "numeric", month: "short", year: "numeric" });
    }

    function updateDisplay(weekType) {
      const data = weekType === "A" ? weekA : weekB;
      const banner = document.getElementById("banner");
      const switchBtn = document.getElementById("switchWeek");

      banner.textContent = `${data.name} ‚Äî ${data.onCall} sedang bertugas shift malam (on-call)`;
      banner.className = `banner week${weekType}`;
      switchBtn.style.background = weekType === "A"
        ? "linear-gradient(90deg, #007bff, #00bfff)"
        : "linear-gradient(90deg, #28a745, #70db70)";

      const range = getWeekRange(referenceSunday);
      document.getElementById("dateRange").textContent =
        `${data.name} ‚Ä¢ ${formatDate(range.start)} ‚Äì ${formatDate(range.end)}`;

      renderTable(data, range);
    }

    function renderTable(data, range) {
      const malaysiaNow = getMalaysiaNow();
      const todayIndex = malaysiaNow.getUTCDay(); // 0=Sunday ... 6=Saturday (in UTC)
      const malaysiaDay = new Date(malaysiaNow.getTime());
      const malaysiaWeekday = (malaysiaDay.getUTCDay() + 7) % 7;

      let tableHTML = `
        <tr>
          <th>Hari</th>
          <th>Pagi ‚Äì 11:00</th>
          <th>11:00 ‚Äì 14:00</th>
          <th>14:00 ‚Äì 16:00</th>
          <th>16:00 ‚Äì 18:00</th>
          <th>18:00 ‚Äì Malam</th>
          <th>Shift Malam (on-call)</th>
        </tr>
      `;

      days.forEach((day, i) => {
        const isThisWeek =
          malaysiaNow >= range.start && malaysiaNow <= range.end;
        const isToday = isThisWeek && i === malaysiaWeekday;
        const cls = isToday ? "today" : "";

        tableHTML += `
          <tr class="${cls}">
            <td>${day}</td>
            <td>${data.morning}</td>
            <td>${data.onCall === data.morning ? "‚Äî" : data.onCall}</td>
            <td>${data.morning}</td>
            <td>${data.onCall}</td>
            <td>${data.morning}</td>
            <td>${data.onCall}</td>
          </tr>
        `;
      });
      document.getElementById("scheduleTable").innerHTML = tableHTML;
    }

    const requiredPassword = "87654321";
    const pwdInput = document.getElementById("fname");
    const switchBtn = document.getElementById("switchWeek");
    switchBtn.disabled = true;

    pwdInput.addEventListener("input", () => {
      switchBtn.disabled = pwdInput.value !== requiredPassword;
    });

    switchBtn.addEventListener("click", () => {
      currentWeekType = currentWeekType === "A" ? "B" : "A";
      updateDisplay(currentWeekType);
    });

    document.getElementById("refDate").addEventListener("change", (e) => {
      const newDate = new Date(e.target.value);
      if (!isNaN(newDate)) {
        referenceSunday = newDate;
        currentWeekType = getWeekType(referenceSunday);
        updateDisplay(currentWeekType);
      }
    });

    document.getElementById("exportCSV").addEventListener("click", () => {
      const rows = document.querySelectorAll("#scheduleTable tr");
      const csv = Array.from(rows)
        .map(row => Array.from(row.children)
        .map(cell => `"${cell.innerText}"`)
        .join(","))
        .join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `Jadwal-${currentWeekType}.csv`;
      a.click();
    });

    let currentWeekType = getWeekType(referenceSunday);
    updateDisplay(currentWeekType);
  </script>

</body>
</html>
